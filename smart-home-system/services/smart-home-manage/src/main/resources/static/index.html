<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å®¶å±…æˆ¿é—´ç®¡ç†</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: sans-serif;
            background-color: #f4f6f9;
            margin: 0;
        }
        header {
            background-color: #3f51b5;
            color: white;
            padding: 16px;
            font-size: 24px;
            text-align: center;
        }
        .controls {
            margin: 16px;
            text-align: center;
        }
        input, button, select {
            padding: 8px;
            font-size: 16px;
            border-radius: 4px;
            margin: 10px;
        }
        button {
            background-color: #3f51b5;
            color: white;
            border: none;
            cursor: pointer;
        }
        .room-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px;
        }
        .room-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin: 10px;
            width: 220px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease-in-out;
        }
        .room-card:hover {
            transform: scale(1.05);
        }
        .controls div {
            display: inline-block;
            margin-right: 10px;
        }
        .room-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<header>ğŸ  æ™ºèƒ½å®¶å±…æˆ¿é—´ç®¡ç†</header>

<div class="controls">
    <h2>åˆ›å»ºæ–°æˆ¿é—´</h2>
    <div>
        <label for="roomId">æˆ¿é—´IDï¼š</label>
        <input type="text" id="roomId" placeholder="è¯·è¾“å…¥æˆ¿é—´ID" required>
    </div>
    <div>
        <label for="roomName">æˆ¿é—´åç§°ï¼š</label>
        <input type="text" id="roomName" placeholder="è¯·è¾“å…¥æˆ¿é—´åç§°" required>
    </div>
    <div>
        <label for="roomType">æˆ¿é—´ç±»å‹ï¼š</label>
        <select id="roomType">
            <option value="living-room">å®¢å…</option>
            <option value="bedroom">å§å®¤</option>
            <option value="kitchen-room">å¨æˆ¿</option>
            <option value="bathroom">æµ´å®¤</option>
            <option value="study-room">ä¹¦æˆ¿</option>
            <option value="balcony-room">é˜³å°</option>
            <option value="other">å…¶ä»–</option>
        </select>
    </div>
    <div>
        <button id="submitBtn" onclick="createRoom()">åˆ›å»ºæˆ¿é—´</button>
    </div>
</div>

<div class="room-container" id="roomContainer"></div>

<script>
    let allRooms = [];

    // æˆ¿é—´å›¾æ ‡æ˜ å°„ï¼Œæ ¹æ®æˆ¿é—´åç§°é€‰æ‹©å¯¹åº”å›¾æ ‡
    const roomIcons = {
        "living-room": "ğŸ›‹ï¸",
        "bedroom": "ğŸ›ï¸",
        "kitchen-room": "ğŸ½ï¸",
        "bathroom": "ğŸš¿",
        "study-room": "ğŸ“š",
        "balcony-room": "â˜€ï¸",
        "other": "ğŸ "
    };

    // åŠ è½½æ‰€æœ‰æˆ¿é—´æ•°æ®å¹¶æ¸²æŸ“
    async function loadRooms() {
        try {
            const res = await fetch("/api/rooms");
            if (!res.ok) throw new Error("æ— æ³•åŠ è½½æˆ¿é—´æ•°æ®");
            allRooms = await res.json();
            renderRooms(); // æ¸²æŸ“æˆ¿é—´åˆ—è¡¨
        } catch (error) {
            console.error("åŠ è½½æˆ¿é—´å¤±è´¥:", error);
        }
    }

    // æ¸²æŸ“æˆ¿é—´å¡ç‰‡åˆ°é¡µé¢ä¸­
    function renderRooms() {
        const container = document.getElementById("roomContainer");
        container.innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹

        allRooms.forEach(room => {
            const roomIcon = roomIcons[room.roomType] || roomIcons["é»˜è®¤"];

            const card = document.createElement("div");
            card.className = "room-card";

            // å¡«å……å¡ç‰‡å†…å®¹
            card.innerHTML = `
                <div class="room-icon" style="cursor: pointer;">${roomIcon}</div>
                <h3 class="room-title" style="cursor: pointer;">${room.roomName}</h3>
                <p>æˆ¿é—´ID: ${room.roomId}</p>
                <p>ç±»å‹: ${room.roomType}</p>
                <button onclick="deleteRoom(event, '${room.roomId}')">åˆ é™¤</button>
                <button onclick="editRoom(event, '${room.roomId}')">ç¼–è¾‘</button>
            `;

            // è·³è½¬è¯¦æƒ…é¡µäº‹ä»¶ç»‘å®š
            card.querySelector(".room-icon").onclick = () => {
                window.location.href = `/roomDetail.html?roomId=${room.roomId}`;
            };
            card.querySelector(".room-title").onclick = () => {
                window.location.href = `/roomDetail.html?roomId=${room.roomId}`;
            };

            container.appendChild(card);
        });
    }

    // åˆ›å»ºä¸€ä¸ªæ–°æˆ¿é—´
    async function createRoom() {
        const roomId = document.getElementById("roomId").value.trim();
        const roomName = document.getElementById("roomName").value.trim();
        const roomType = document.getElementById("roomType").value;

        if (!roomId || !roomName || !roomType) {
            alert("è¯·è¾“å…¥å®Œæ•´çš„æˆ¿é—´ä¿¡æ¯");
            return;
        }

        try {
            const newRoom = { roomId, roomName, roomType };
            const res = await fetch("/api/rooms", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(newRoom)
            });

            if (!res.ok) throw new Error("åˆ›å»ºæˆ¿é—´å¤±è´¥");

            // æ¸…ç©ºè¡¨å•
            document.getElementById("roomId").value = "";
            document.getElementById("roomName").value = "";
            document.getElementById("roomType").value = "";

            const createdRoom = await res.json();
            allRooms.push(createdRoom); // æ·»åŠ åˆ°æœ¬åœ°æˆ¿é—´æ•°ç»„
            renderRooms(); // é‡æ–°æ¸²æŸ“
        } catch (error) {
            console.error("åˆ›å»ºæˆ¿é—´å¤±è´¥:", error);
        }
    }

    // åˆ é™¤æŒ‡å®šæˆ¿é—´
    async function deleteRoom(event, roomId) {
        event.stopPropagation(); // é˜»æ­¢ç‚¹å‡»å†’æ³¡ï¼Œé¿å…è·³è½¬è¯¦æƒ…é¡µ
        try {
            if (!confirm("ç¡®è®¤åˆ é™¤æ­¤è®¾å¤‡ï¼Ÿ")) return;
            const res = await fetch(`/api/rooms/${roomId}`, {
                method: "DELETE"
            });

            if (!res.ok) throw new Error("åˆ é™¤æˆ¿é—´å¤±è´¥");

            // ä»æœ¬åœ°æ•°ç»„ä¸­ç§»é™¤
            allRooms = allRooms.filter(room => room.roomId !== roomId);
            renderRooms(); // é‡æ–°æ¸²æŸ“
        } catch (error) {
            console.error("åˆ é™¤æˆ¿é—´å¤±è´¥:", error);
        }
    }

    // ç¼–è¾‘æˆ¿é—´ä¿¡æ¯ï¼šå¡«å……è¡¨å• + åˆ‡æ¢æŒ‰é’®ä¸ºæ›´æ–°
    async function editRoom(event, roomId) {
        event.stopPropagation(); // é˜»æ­¢è·³è½¬è¯¦æƒ…é¡µ

        const room = allRooms.find(r => r.roomId === roomId);
        if (!room) {
            alert("æˆ¿é—´ä¸å­˜åœ¨");
            return;
        }

        // å¡«å……è¡¨å•æ•°æ®
        document.getElementById("roomId").value = room.roomId;
        document.getElementById("roomName").value = room.roomName;
        document.getElementById("roomType").value = room.roomType;

        // åˆ‡æ¢æŒ‰é’®ä¸ºæ›´æ–°æ¨¡å¼
        const createButton = document.getElementById("submitBtn");
        createButton.innerText = "æ›´æ–°æˆ¿é—´";
        createButton.onclick = () => updateRoom(roomId);
    }

    // æ›´æ–°å·²å­˜åœ¨çš„æˆ¿é—´ä¿¡æ¯
    async function updateRoom(roomId) {
        const roomName = document.getElementById("roomName").value.trim();
        const roomType = document.getElementById("roomType").value;

        if (!roomName || !roomType) {
            alert("è¯·è¾“å…¥æˆ¿é—´åç§°å’Œç±»å‹");
            return;
        }

        try {
            const updatedRoom = { roomId, roomName, roomType };
            const res = await fetch(`/api/rooms/${roomId}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(updatedRoom)
            });

            if (!res.ok) throw new Error("æ›´æ–°æˆ¿é—´å¤±è´¥");

            const updatedRoomData = await res.json();
            allRooms = allRooms.map(room => room.roomId === roomId ? updatedRoomData : room);
            renderRooms(); // æ›´æ–°é¡µé¢

            // é‡ç½®è¡¨å•å¹¶æ¢å¤æŒ‰é’®ä¸ºâ€œåˆ›å»ºæˆ¿é—´â€
            document.getElementById("roomId").value = "";
            document.getElementById("roomName").value = "";
            document.getElementById("roomType").value = "";
            const createButton = document.getElementById("submitBtn");
            createButton.innerText = "åˆ›å»ºæˆ¿é—´";
            createButton.onclick = createRoom;
        } catch (error) {
            console.error("æ›´æ–°æˆ¿é—´å¤±è´¥:", error);
        }
    }

    // é¡µé¢åŠ è½½æ—¶è·å–æ‰€æœ‰æˆ¿é—´
    loadRooms();
</script>

</body>
</html>
